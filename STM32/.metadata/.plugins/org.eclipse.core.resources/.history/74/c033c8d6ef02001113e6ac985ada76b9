/*
 * j_st7789.h
 *  
 * This library is aimed at making controlling your ST7789 hardware easier.
 * Please take the time to edit the configuration variables below to your LCD
 * display.
 *
 *  Created on: Feb 4, 2026
 *      Author: jonar
 */

#ifndef J_ST7789_H_
#define J_ST7789_H_
#include "j_fonts.h"
#include "main.h"
#include "spi.h"
#include "usart.h"
#include "gpio.h"

// J_ST CFG ------------------------------
#define J_CFG_DC_PIN GPIO_PIN_0
#define J_CFG_DC_PORT GPIOC

#define J_CFG_RES_PIN GPIO_PIN_4
#define J_CFG_RES_PORT GPIOC

#define J_CFG_SCREEN_LENGTH 240
#define J_CFG_SCREEN_HEIGHT 240
#define J_CFG_BYTES_PER_PIXEL 2

#define J_CFG_SPI_OBJ hspi3
// ----------------------------------------

// PRIVATE DEFINES (do not change) --------
#define CMD_SLPIN 0x10
#define CMD_SLPOUT 0x11
#define CMD_NORON 0x13
#define CMD_DISPON 0x29
#define CMD_DISPOFF 0x28
#define CMD_SWFRES 0x01
#define CMD_COLMOD 0x3A
#define CMD_MADCTL 0x36
#define CMD_RAMWR 0x2C
#define CMD_INVON 0x21
#define CMD_INVOFF 0x20
#define CMD_CASET 0x2A
#define CMD_RASET 0x2B

#define J_BIT_DEPTH J_CFG_BYTES_PER_PIXEL
#define J_HEIGHT J_CFG_SCREEN_HEIGHT
#define J_LENGTH J_CFG_SCREEN_LENGTH
#define J_DIV 3
#define J_BUF_SIZE (J_HEIGHT * (J_LENGTH/J_DIV) * 2)
// ----------------------------------------

typedef enum {
    J_WHITE = 0xFFFF,
    J_BLACK = 0x0000,
    J_BLUE = 0x001F,
    J_CYAN = 0x00EF,
    J_RED = 0xF000,
    J_PINK = 0xF00F,
    J_GREEN = 0x0E00
} j_color;

typedef enum {
    J_TEXT = 0,
    J_SHAPE
} j_entity_type;

typedef struct {
    j_entity_type type;
    uint8_t x, y;
    
} j_entity;

typedef struct {
    j_color bgcol;
    uint8_t num_entities;
    
} j_struct;

static uint8_t j_bounds[] = {0,J_CFG_SCREEN_LENGTH,0,J_CFG_SCREEN_HEIGHT};
static char j_flag_set_bounds = 1;

static j_struct j_master_control = {
    J_RED,
    0
};


void write_cmd(uint8_t CMD);
void write_u8(uint8_t* dat, size_t len);
void write_s8(uint8_t dat);
void init_lcd();
void set_bounds(uint8_t xlo, uint8_t xhi, uint8_t ylo, uint8_t yhi);
void fill_area(uint16_t color);
void fill_text(uint8_t x, uint8_t y, char* str, uint8_t font_size, j_color color);
void draw_text(char ch, uint8_t font_size, j_color FILL_COL);

#endif /* J_ST7789_H_ */
